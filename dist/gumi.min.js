!function(a,b,c,d){var e={buttonClass:"gumi-btn-default",buttonSelectedClass:"gumi-btn-selected",optionDisabledClass:"gumi-option-disabled",dropdownClass:"gumi-dropdown-default",onChange:function(){},onOpen:function(){}};var f=function(b,c){this.elem=b,this.$elem=a(b),this.$elem.addClass("gumi-wrap"),this.$button=a("<button />"),this.$dropdown=this.$elem.find("ul").hide(),this.$select=a("<select />"),this.selectedIndex=0,this.selectedLabel=d,this.selectedValue=d,this.options=a.extend({},e,c),this._load=!0,this._defaults=e,this._initialSelected=d,this._init()};f.prototype={constructor:f,_init:function(){this._createSelect(),this._createDropdown(),this._bindDropdown(),this._bindSelectOption()},_createSelect:function(){var a=this,b;var c=this.$elem.find("button");c.length&&(this.$button=c),b=this._updateSelect(),this.$elem.append(this.$select),this.initialSelected=b,this._load=!1},_updateSelect:function(){var b=this,c=0;return this.$select.addClass(this.options.dropdownClass).addClass(this.$button.data("class")).attr("name",this.$button.data("name")).prop("required",this.$button.data("required")).hide(),this._deserializeParams(),this.$elem.find("li").each(function(e){var f=a(this),g=f.data("value");var h=g===d&&""!==g?f.html():String(g),i=f.data("label")||f.html()||h;f.data("selected")===!0&&(c=e),f.data("disabled")===!0&&f.addClass(b.options.optionDisabledClass),f.data("selectable")===!1&&f.hide(),a("<option />").val(h).append(i).addClass(f.attr("class")).appendTo(b.$select)}),this.setSelectedOption(c),c},_createDropdown:function(){this.$button.addClass("gumi-btn").addClass(this.options.buttonClass),this.$elem.prepend(this.$button),this.$dropdown.addClass("gumi-dropdown").addClass(this.options.dropdownClass)},_bindDropdown:function(){var b=this;this.$button.on("click.Gumi",function(a){a.preventDefault(),a.stopPropagation(),b._resetDropdowns(b.$elem),b.$button.toggleClass(b.options.buttonSelectedClass),b.$dropdown.toggle(),b.$dropdown.is(":visible")&&b.options.onOpen.call(b.$elem)}),a(c).off("click.Gumi"),a(c).on("click.Gumi",function(c){0===a(c.target).closest(".gumi-dropdown").length&&b._resetDropdowns()})},_bindSelectOption:function(){var b=this;b.$dropdown.on("click.Gumi","li",function(c){var d=a(this);c.stopPropagation(),d.data("disabled")||(b.setSelectedOption(a(this).index()),b.closeDropdown())})},_resetDropdowns:function(b){a(".gumi-wrap").not(b).each(function(){a(this).data("gumi").closeDropdown()})},_deserializeParams:function(){var a=this.$button.data("params"),b={};if(a&&"string"==typeof a){a=a.split(" ");var c;for(var d=0,e=a.length;e>d;d++)c=a[d].split("="),b[c[0]]=c[1];this._addDataToSelect(b)}},_addDataToSelect:function(a){for(var b in a)this.$select.data(b,a[b])},update:function(){this.$elem.find("select").empty(),this._updateSelect()},setSelected:function(a){var b=this.$select.find('option[value="'+a+'"]');b.length&&this.setSelectedOption(b.index())},setSelectedOption:function(a){a=a||0;var b=this.$select.find("option").eq(a);this.selectedIndex=a,this.selectedLabel=this.$dropdown.eq(a).data("label")||b.text(),this.selectedValue=b.val(),b.prop("selected",!0).trigger("change"),(this._load===!1||this._load===!0&&!this.$button.data("default-value"))&&(this.$button.html("<span><em>"+this.selectedLabel+'</em><i class="icn arrow-down">&nbsp;</i></span>'),this.options.onChange.call(this.$select))},onEvent:function(a,b){"function"==typeof b&&this.options[a]&&(this.options[a]=b)},closeDropdown:function(){this.$button.removeClass(this.options.buttonSelectedClass),this.$dropdown.hide()},reset:function(){this.setSelectedOption(this._initialSelected)}},a.fn.gumi=function(b){var c=arguments,d=this;return this.each(function(e){var g=a.data(this,"gumi");g?"string"==typeof b&&"function"==typeof g[b]&&g[b].apply(g,Array.prototype.slice.call(c,1)):(a.data(this,"gumi",new f(this,b)),e===d.length-1&&a(this).trigger("ready.Gumi"))})}}(jQuery,window,document);